<div class="container p-4">
    <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div id="sidebar-wrapper">
      <div class="sidebar-heading">Jugadores</div>
      <ul class="list-group" id="players"></ul>
    </div>
    <!-- /#sidebar-wrapper -->
    <!-- Page Content -->
    <div>
      <nav class="navbar navbar-expand-lg navbar-light">
        <button class="btn btn-primary" id="menu-toggle">Toggle</button>
        <div style="margin-left: 2em;">
          <p id="p_name"></p>
        </div>
      </nav>     
      <div class="container-fluid">
        <div id="board" style="text-align:center; margin-top: 1em;">
          <div id="c_table" style="display: inline-flex;"></div>
          <hr>
          <div id="c_player" style="display: inline-flex;"></div>
        </div>
        <div style="margin-top: 2em;">           
          <button style="margin: 0.5em;" class="btn btn-secondary btn-block" data-toggle="modal" data-target="#modal">Cambiar Nombre</button>                        
          <button style="margin: 0.5em;" class="btn btn-info btn-block" id="end_turn">Terminar Turno</button>
          <button style="margin: 0.5em;" class="btn btn-info btn-block" id="init">Iniciar Partida</button>                                
        </div>
      </div>
    </div>
    <!-- #content -->
  </div>
</div>
<div class="modal" id="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nombre de Jugador</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <input type="text" id="t_nombre" style="text-transform:uppercase" class="form-control">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="nombre">Guardar</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
<script>
    function reset()
    {
      $('#c_table').empty();
      $('#c_player').empty();
      for(let i=0; i < 5; i++)
      {
          $('#c_table').append('<div class="col-sm" style="padding-right: 0.2em; padding-top: 0;"><img src="/pics/cards/card_back.svg" style="width: 100%; height: 100%;"></div>');
          $('#c_player').append('<div class="col-sm" style="padding-right: 0.2em; padding-bottom: 0;"><img src="/pics/cards/card_back.svg" style="width: 100%; height: 100%;"></div>');
      }           
    }

    let p_card;
    let t_card;

    function selectPlayerCard(e)
    {
      if(p_card === $(e).attr('id'))
      {
        $(e).css({"padding-bottom": "0"});
        p_card = '';
        return
      }
      $('#c_player').children().css({"padding-bottom": "0"});
      $(e).css({"padding-bottom": "2em"});
      p_card = $(e).attr('id');      
    }

    function selectTableCard(e)
    {
      if(t_card === $(e).attr('id'))
      {
        $(e).css({"padding-top": "0"});
        t_card = '';
        return
      }
      $('#c_table').children().css({"padding-top": "0"});
      $(e).css({"padding-top": "2em"});
      t_card = $(e).attr('id');
    }

    $(function (){
        ///Fontend Settings ->>
        //Toastr Options
        toastr.options.preventDuplicates = true;
     
        //Side Bar Display
        $("#menu-toggle").click(function(e) {
            e.preventDefault();
            $("#wrapper").toggleClass("toggled");
        });

        //Modal
        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        });       

        //Init Gameboard
        reset();

        //WebSockets
        const socket = io();
        //Get Status
        socket.on('connected', (data) => {
            toastr.success(data);
        });
        socket.on('disconnected', (data) => {
            toastr.warning(data);
        });
        //Get Message
        socket.on('message', (data) => {
            toastr.info(data);
        });
        //Get Data
        socket.on('players', (data) => {
            $('#players').empty();
            for(let i=0; i < data.length; i++)
            {
                if(socket.id == data[i].id)
                {
                  if(data[i].nombre)
                  {$('#p_name').text(data[i].nombre + ' - ' + data[i].id);}else
                  {$('#p_name').text(data[i].id);}               
                }
                if(data[i].nombre)
                {$('#players').append('<li id="' + data[i].id + '" class="list-group-item">' + data[i].nombre + '<br>' + data[i].id + '</li>');}else
                {$('#players').append('<li id="' + data[i].id + '" class="list-group-item">' + data[i].id + '</li>');}
            }           
        });
        socket.on('init', (data) => {
            $('#c_player').empty();
            for(let i=0; i < data.hand.length; i++)
            {
                $('#c_player').append('<div class="col-sm" id="' + (data.hand[i].value + data.hand[i].type) + '" style="padding-right: 0.2em; padding-bottom: 0;" onClick="selectPlayerCard(this);"><img src="/pics/cards/' + data.hand[i].img + '" style="width: 100%; height: 100%;"></div>');
            }
            //Disable Init button
            $('#init').hide();       
        });
        socket.on('room_data', (data) => {
            if(data)
            {
              //Check Table Cards
              if(data.c_ronda)
              {
                $('#c_table').empty();
                for(let i=0; i < data.c_table.length; i++)
                {
                    $('#c_table').append('<div class="col-sm" id="' + (data.c_table[i].value + data.c_table[i].type) + '" style="padding-right: 0.2em; padding-top: 0;" onClick="selectTableCard(this);"><img src="/pics/cards/' + data.c_table[i].img + '" style="width: 100%; height: 100%;"></div>');
                }                  
              }

              //Set Turn Display
              $('#players').children().css('background', '#ffffff');
              $('#'+ data.p_turn).css('background','#8ec252');
              if(socket.id == data.p_turn)
              {
                toastr.info($('#p_name').text(), 'Es tu Turno:');
                //Enable End_Turn button
                $('#end_turn').show();
              }
              else{$('#end_turn').hide();}

              //Get Game State
              
            }
        });
        //Send Data
        $('#init').on('click', () => {
            socket.emit('init');
        });
        $('#end_turn').on('click', () => {
            socket.emit('end_turn');
        });
        $('#nombre').on('click', () => {
            $('#modal').modal('hide');
            socket.emit('nombre', $('#t_nombre').val().toUpperCase());
        });
    });
</script>